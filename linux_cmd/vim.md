# Vim

vim编辑器是vi的进阶版，是一个静态文本编辑器。可以完成 编辑/搜索/定位/正则表达式/分屏 等功能。

![](https://www.runoob.com/wp-content/uploads/2015/10/vi-vim-cheat-sheet-sch.gif)

## 入门使用

```
命令模式
	:w   保存文件但不退出vi
	:w file 将修改另外保存到file中，不退出vi
	:w!   强制保存，不推出vi
	:wq  保存文件并退出vi
	:wq! 强制保存文件，并退出vi
	:q  不保存文件，退出vi
	:q! 不保存文件，强制退出vi
	:e! 放弃所有修改，从上次保存文件开始再编辑
    :x! 强制写入，即使文件没有写属性

编辑模式
	进入到编辑模式的常用命令。
	i 从目前光标所在处插入。
	I 从目前光标所在处第一个非空格开始插入。
	a 从光标所在处的下一个字符开始插入。
	A 从光标所在处行的最后一个字符卡是插入
	o 从目前光标所在处的下一行插入新的一行。
	O 为在目前光标所在处的上面一行插入新的一行。
	r 进入一次替换插入，即在目前光标的下一行插入新的一行。
	R 一直替换插入，直到按下esc为止。

一般模式
	h 建向左移动
	j 向下移动
	k 向上移动
	l 向右移动
	CTRL f 向下移动一页
	CTRL b向上移动一页
	CTRL d 向下移动半页
	CTRL u 向上移动半页
	+ 光标移动到非空格的下一行
	-光标移动到非空格的上一行
	n <space> n表示数字，加上空格，向当前移动多少个字符。
	0 <space>移动到改行的开始处
	o 换行
	H 移动到上行的第一个字符，
	M 移动到中间那行的第一个字符。
	L 移动到屏幕最下方那一行的第一个字符。
	G 移动到文件最后一行（常用）
	nG移动到文件第几行
	gg移动到这个文件的第一行。
	n<enter> 光标移动到这个文件的第一行
	/word 查找文字为WOED 的字符。向下
	?word 向上寻找一个为WORD 的字符。
	n 此按键位英文按键，表示继续重复前一个查找动作，
	N 此按键为英文按键，表示继续相反地方向重复前一个查找动作。
	:n1,n2s/word1/word2/g表示n1-n2行的word1被替换为word2
	:n1,$s/word1/word2/g 便是从n1-末行的word1被替换为word2
	:n1,$s/word1/word2/gc 功能同上给予确认的替换。
	:s/foo/bar/g  	当前行替换
	:%s/foo/bar/g   全文替换
	x 删除光标所在的的后面一个字符。相当于DEL键
	nx 此处n为数字，表示删除n个字符。
	dd 删除光标所在行
	ndd 删除光标所在行下面n行
	d1G删除光标所在行到第一行的所有数据。
	dG 删除光标所在行到最后一行的所有数据。
	d$ 删除光标所在处到该行的所有数据。
	d0 删除光标所在行到第一行的所有数据
	c重复删除多个数据，
	yy 复制光标所在那一行的所有数据
	nyy 复制光标所在的所在的向下n行，n为数字
	y1G 复制光标所在行到第一行的所有数据。
	yG 复制光标所在行到最后一行的搜有数据。
	y0 复制光标处到第一行的所有数据。
	y$ 复制光标到末行的所有数据。
	p 将复制的数据向下面一行粘贴
	P将复制的数据向上面粘贴
	J 将光标所在行与下一行结合成一行。
	u 复原上一个操作。
	Ctrl +r 重复上面一个操作。
	:set nu 显示行号
```

## 进阶使用

一些常用的Vim配置，在~/.vimrc中

```
syntax on       支持语法高亮
set nu          显示行号
set nonu      不显示行号
set ai          设置自动缩进
set shiftwidth=4   设置自动缩进 4 个空格, 当然要设自动缩进先.
set sts=4          即设置 softtabstop 为 4. 输入 tab 后就跳了 4 格.
set tabstop=4      实际的 tab 即为 4 个空格, 而不是缺省的 8 个.
set expandtab      在输入 tab 后, vim 用恰当的空格来填充这个 tab.
:set hls 打开搜索高亮
:set nohls 取消搜索高亮 
:set list ： 显示特殊字符
:set nolist 
``` 

### 1. Vim的几种模式

正常模式：可以使用快捷键命令，或按 `:` 输入命令行。
插入模式：可以输入文本，在正常模式下，按 `i、a、o` 等都可以进入插入模式。
可视模式：正常模式下按 `v` 可以进入可视模式， 在可视模式下，移动光标可以选择文本。
按 `V` 进入可视行模式， 总是整行整行的选中。`ctrl+v` 进入可视块模式。
替换模式：正常模式下，按 `R` 进入。

### 2. 启动Vim
```
vim -c cmd file: 在打开文件前，先执行指定的命令；
vim -r file: 恢复上次异常退出的文件；
vim -R file: 以只读的方式打开文件，但可以强制保存；
vim -M file: 以只读的方式打开文件，不可以强制保存；
vim -y num file: 将编辑窗口的大小设为num行；
vim + file: 从文件的末尾开始；
vim +num file: 从第num行开始；
vim +/string file: 打开file，并将光标停留在第一个找到的string上。
vim –remote file: 用已有的vim进程打开指定的文件。 如果不想启用多个vim会话，这个很有用。
```

但要注意， 如果用vim，会寻找名叫VIM的服务器；如果已经有一个gvim在运行了，可以用gvim –remote file在已有的gvim中打开文件。

### 3. 文档操作
```
:e file –关闭当前编辑的文件，并开启新的文件。 如果对当前文件的修改未保存，vi会警告。
:e! file –放弃对当前文件的修改，编辑新的文件。
:e! — 重新加载当前文档，并丢弃已做的改动。
:e#或ctrl+^ — 回到刚才编辑的文件，很实用。
:f或ctrl+g — 显示文档名，是否修改，和光标位置。
:f filename — 改变编辑的文件名，这时再保存相当于另存为。
:w — 保存修改。
:n1,n2w filename — 选择性保存从某n1行到另n2行的内容。
:wq — 保存并退出。
ZZ — 保存并退出。
:q[uit] ——退出当前窗口。(CTRL-W q或CTRL-W CTRL-Q)
:saveas newfilename — 另存为
```

### 4. 基本移动

以下移动都是正常模式下。

```
h或退格: 左移一个字符；
l或空格: 右移一个字符；
j: 下移一行；
k: 上移一行；
gj: 移动到一段内的下一行；
gk: 移动到一段内的上一行；
+或Enter: 把光标移至下一行第一个非空白字符。
-: 把光标移至上一行第一个非空白字符。
w: 前移一个单词，光标停在下一个单词开头；
W: 移动下一个单词开头，但忽略一些标点；
e: 前移一个单词，光标停在下一个单词末尾；
E: 移动到下一个单词末尾，如果词尾有标点，则移动到标点；
b: 后移一个单词，光标停在上一个单词开头；
B: 移动到上一个单词开头，忽略一些标点；
ge: 后移一个单词，光标停在上一个单词末尾；
gE: 同 ge ，不过'单词’包含单词相邻的标点。
(: 前移1句。
): 后移1句。
{: 前移1段。
}: 后移1段。
fc: 把光标移到同一行的下一个c字符处
Fc: 把光标移到同一行的上一个c字符处
tc: 把光标移到同一行的下一个c字符前
Tc: 把光标移到同一行的上一个c字符后
;: 配合f & t使用，重复一次
,: 配合f & t使用，反向重复一次
```

上面的操作都可以配合n使用，比如在正常模式(下面会讲到)下输入3h， 则光标向左移动3个字符。

```
0: 移动到行首。
g0: 移到光标所在屏幕行行首。
^: 移动到本行第一个非空白字符。
g^: 同 ^ ，但是移动到当前屏幕行第一个非空字符处。
$: 移动到行尾。
g$: 移动光标所在屏幕行行尾。
n|: 把光标移到递n列上。
nG: 到文件第n行。
:n<cr> 移动到第n行。
:$<cr> 移动到最后一行。
H: 把光标移到屏幕最顶端一行。
M: 把光标移到屏幕中间一行。
L: 把光标移到屏幕最底端一行。
gg: 到文件头部。
G: 到文件尾部。
```

### 5. 翻屏

```
ctrl+f: 下翻一屏。
ctrl+b: 上翻一屏。
ctrl+d: 下翻半屏。
ctrl+u: 上翻半屏。
ctrl+e: 向下滚动一行。
ctrl+y: 向上滚动一行。
n%: 到文件n%的位置。
zz: 将当前行移动到屏幕中央。
zt: 将当前行移动到屏幕顶端。
zb: 将当前行移动到屏幕底端。
```

使用标记可以快速移动。到达标记后，可以用Ctrl+o返回原来的位置。

Ctrl+o和Ctrl+i 很像浏览器上的 后退 和 前进 。

```
m{a-z}: 标记光标所在位置，局部标记，只用于当前文件。
m{A-Z}: 标记光标所在位置，全局标记。标记之后，退出Vim， 重新启动，标记仍然有效。
`{a-z}: 移动到标记位置。
'{a-z}: 移动到标记行的行首。
`{0-9}：回到上[2-10]次关闭vim时最后离开的位置。
": 移动到上次编辑的位置。
`": 移动到上次离开的地方。
`.: 移动到最后改动的地方。
:marks 显示所有标记。
:delmarks a b — 删除标记a和b。
:delmarks a-c — 删除标记a、b和c。
:delmarks a c-f — 删除标记a、c、d、e、f。
:delmarks! — 删除当前缓冲区的所有标记。
:help mark-motions 查看更多关于mark的知识。
```

### 6. 插入文本

基本插入

```
i: 在光标前插入；一个小技巧：按8，再按i，进入插入模式，输入=， 按esc进入命令模式，就会出现8个=。
这在插入分割线时非常有用，如30i+<esc>就插入了36个+组成的分割线。
I: 在当前行第一个非空字符前插入；
gI: 在当前行第一列插入；
a: 在光标后插入；
A: 在当前行最后插入；
o: 在下面新建一行插入；
O: 在上面新建一行插入；
:r filename在当前位置插入另一个文件的内容。
:[n]r filename在第n行插入另一个文件的内容。
:r !date 在光标处插入当前日期与时间。同理，:r !command可以将其它shell命令的输出插入当前文档。
```

改写插入

```
c[n]w: 改写光标后1(n)个词。
c[n]l: 改写光标后n个字母。
c[n]h: 改写光标前n个字母。
[n]cc: 修改当前[n]行。
[n]s: 以输入的文本替代光标之后1(n)个字符，相当于c[n]l。
[n]S: 删除指定数目的行，并以所输入文本代替之。
```

### 7. 剪切复制和寄存器

剪切和复制、粘贴

```
[n]x: 剪切光标右边n个字符，相当于d[n]l。
[n]X: 剪切光标左边n个字符，相当于d[n]h。
y: 复制在可视模式下选中的文本。
yy or Y: 复制整行文本。
y[n]w: 复制一(n)个词。
y[n]l: 复制光标右边1(n)个字符。
y[n]h: 复制光标左边1(n)个字符。
y$: 从光标当前位置复制到行尾。
y0: 从光标当前位置复制到行首。
:m,ny<cr> 复制m行到n行的内容。
y1G或ygg: 复制光标以上的所有行。
yG: 复制光标以下的所有行。
yaw和yas：复制一个词和复制一个句子，即使光标不在词首和句首也没关系。
d: 删除（剪切）在可视模式下选中的文本。
d$ or D: 删除（剪切）当前位置到行尾的内容。
d[n]w: 删除（剪切）1(n)个单词
d[n]l: 删除（剪切）光标右边1(n)个字符。
d[n]h: 删除（剪切）光标左边1(n)个字符。
d0: 删除（剪切）当前位置到行首的内容
[n] dd: 删除（剪切）1(n)行。
:m,nd<cr> 剪切m行到n行的内容。
d1G或dgg: 剪切光标以上的所有行。
dG: 剪切光标以下的所有行。
daw和das：剪切一个词和剪切一个句子，即使光标不在词首和句首也没关系。
d/f<cr>：这是一个比较高级的组合命令，它将删除当前位置 到下一个f之间的内容。
p: 在光标之后粘贴。
P: 在光标之前粘贴。
```

文本对象

```
aw：一个词
as：一句。
ap：一段。
ab：一块（包含在圆括号中的）。
y, d, c, v都可以跟文本对象。
```

寄存器

```
a-z：都可以用作寄存器名。"ayy把当前行的内容放入a寄存器。
A-Z：用大写字母索引寄存器，可以在寄存器中追加内容。 如"Ayy把当前行的内容追加到a寄存器中。
:reg 显示所有寄存器的内容。
""：不加寄存器索引时，默认使用的寄存器。
"*：当前选择缓冲区，"*yy把当前行的内容放入当前选择缓冲区。
"+：系统剪贴板。"+yy把当前行的内容放入系统剪贴板。
```

### 8. 查找与替换

#### 查找

```
/something: 在后面的文本中查找something。
?something: 在前面的文本中查找something。
/pattern/+number: 将光标停在包含pattern的行后面第number行上。
/pattern/-number: 将光标停在包含pattern的行前面第number行上。
* 当光标停留在某个单词上时, 输入这条命令表示查找与该单词匹配的下一个单词.
# 当光标停留在某个单词上时, 输入这条命令表示查找与该单词匹配的上一个单词.
    可以使用shift+* 或 shift + #来查找当前光标所在单词
g*(g#) 此命令与上条命令相似, 只不过它不完全匹配光标所在处的单词, 而是匹配包含该单词的所有字符串.    
n: 向后查找下一个。
N: 向前查找下一个。
% 查找与光标所在处相匹配的反括号, 包括 () [] { }.
```


#### 替换

```
:s/old/new – 用new替换当前行第一个old。
:s/old/new/g – 用new替换当前行所有的old。
:n1,n2s/old/new/g – 用new替换文件n1行到n2行所有的old。
:%s/old/new/g – 用new替换文件中所有的old。
:%s/^/xxx/g – 在每一行的行首插入xxx，^表示行首。
:%s/$/xxx/g – 在每一行的行尾插入xxx，$表示行尾。
所有替换命令末尾加上c，每个替换都将需要用户确认。 如：%s/old/new/gc，加上i则忽略大小写(ignore)。
还有一种比替换更灵活的方式，它是匹配到某个模式后执行某种命令，
语法为 :[range]g/pattern/command
例如 :%g/^ xyz/normal dd。
表示对于以一个空格和xyz开头的行执行normal模式下的dd命令。
```

#### 关于range的规定为：

```
如果不指定range，则表示当前行。
m,n: 从m行到n行。
0: 最开始一行（可能是这样）。
$: 最后一行
.: 当前行
%: 所有行
```

#### 正则表达式

```
\d: 表示十进制数（我猜的）
\s: 表示空格
\S: 非空字符
\a: 英文字母
\|: 表示 或
\.: 表示.
{m,n}: 表示m到n个字符。这要和 \s与\a等连用，如 \a\{m,n} 表示m 到n个英文字母。
{m,}: 表示m到无限多个字符。
**: 当前目录下的所有子目录。
:help pattern得到更多帮助。
```

正则表达式的元字符必须用反斜杠进行转义才行， 如 `/foo(1)`就要写成 `/foo\(1\)` , `/\d{2}/` 就要写成 `/\d\{2\}/` 
这样写起来十分麻烦，因此vim设置了magic 来处理。magic设置哪些元字符要加反斜杠哪些不用加的。

magic (\m)：除了 `$ . * ^`  之外其他元字符都要加反斜杠。  
nomagic (\M)：除了 `$ ^` 之外其他元字符都要加反斜杠。  
这个设置可以在正则表达式中通过 `\m \M` 开关临时切换。 `\m` 后面的正则表达式会按照 magic 处理，`\M` 后面的正则表达式按照 nomagic 处理， 而忽略实际的magic设置。

例如：

```
/\m.* # 查找任意字符串 /\M.* # 查找字符串 .* （点号后面跟个星号）
```

还有更强大的 `\v` 和 `\V`。

`\v`（即 very magic 之意）：任何元字符都不用加反斜杠   
`\V`（即 very nomagic 之意）：任何元字符都必须加反斜杠

例如：

```
/\v(a.c){3}$ # 查找行尾的abcaccadc 
/\m(a.c){3}$ # 查找行尾的(abc){3} 
/\M(a.c){3}$ # 查找行尾的(a.c){3} 
/\V(a.c){3}$ # 查找任意位置的(a.c){3}$
```

默认设置是 magic，vim也推荐大家都使用magic的设置，在有特殊需要时，直接通过 `\v\m\M\V` 即可。

### 9. 分屏编辑
```
vim -o file1 file2:水平分割窗口，同时打开file1和file2
vim -O file1 file2:垂直分割窗口，同时打开file1和file2
```

水平分割

```
:split(:sp) — 把当前窗水平分割成两个窗口。
    (CTRL-W s 或 CTRL-W CTRL-S) 注意如果在终端下，CTRL-S可能会冻结终端，请按CTRL-Q继续。
:split filename — 水平分割窗口，并在新窗口中显示另一个文件。
:nsplit(:nsp) — 水平分割出一个n行高的窗口。
:[N]new — 水平分割出一个N行高的窗口，并编辑一个新文件。 (CTRL-W n或 CTRL-W CTRL-N)
ctrl+w f –水平分割出一个窗口，并在新窗口打开名称为光标所在词的文件 。
C-w C-^ — 水平分割一个窗口，打开刚才编辑的文件。
```

垂直分割

```
:vsplit(:vsp) — 把当前窗口分割成水平分布的两个窗口。 (CTRL-W v或CTRL CTRL-V)
:[N]vne[w] — 垂直分割出一个新窗口。
:vertical 水平分割的命令： 相应的垂直分割。
```

### 10. 关于多窗口

```
:qall — 关闭所有窗口，退出vim。
:wall — 保存所有修改过的窗口。
:only — 只保留当前窗口，关闭其它窗口。(CTRL-W o)
:close — 关闭当前窗口，CTRL-W c能实现同样的功能。 (象 :q :x同样工作 )
```

调整窗口大小

```
ctrl+w + –当前窗口增高一行。也可以用n增高n行。
ctrl+w – –当前窗口减小一行。也可以用n减小n行。
ctrl+w _ –当前窗口扩展到尽可能的大。也可以用n设定行数。
:resize n — 当前窗口n行高。
ctrl+w = — 所有窗口同样高度。
n ctrl+w _ — 当前窗口的高度设定为n行。
ctrl+w < –当前窗口减少一列。也可以用n减少n列。
ctrl+w > –当前窗口增宽一列。也可以用n增宽n列。
ctrl+w | –当前窗口尽可能的宽。也可以用n设定列数。
```

切换和移动窗口。如果支持鼠标，切换和调整子窗口的大小就简单了。

```
ctrl+w ctrl+w: 切换到下一个窗口。或者是ctrl+w w。
ctrl+w p: 切换到前一个窗口。
ctrl+w h(l,j,k):切换到左（右，下，上）的窗口。
ctrl+w t(b):切换到最上（下）面的窗口。
ctrl+w H(L,K,J): 将当前窗口移动到最左（右、上、下）面。
ctrl+w r：旋转窗口的位置。
ctrl+w T: 将当前的窗口移动到新的标签页上。
```

### 11. 快速编辑

改变大小写

```
~: 反转光标所在字符的大小写。
可视模式下的U或u：把选中的文本变为大写或小写。
gu(U)接范围（如$，或G），可以把从光标当前位置到指定位置之间字母全部 转换成小写或大写。
如ggguG，就是把开头到最后一行之间的字母全部变为小 写。再如gu5j，把当前行和下面四行全部变成小写。
```


替换（normal模式）

```
r: 替换光标处的字符，同样支持汉字。
R: 进入替换模式，按esc回到正常模式。
```

撤消与重做（normal模式）

```
[n] u: 取消一(n)个改动。
:undo 5 — 撤销5个改变。
:undolist — 的撤销历史。
ctrl + r: 重做最后的改动。
U: 取消当前行中所有的改动。
:earlier 4m — 回到4分钟前
:later 55s — 前进55秒
```

### 12. 其他

查看当前vim打开的文件：vim下 `:f`

vim中去除空行或行末的^M：`dos2unix ufile`

VIM中sort不能用：只能在terminal下执行 `sort -u file > file_new`
 
vim中diff文件： 如果已经打开了一个文件，则 `:vert diffsplit file2` ， 如果还没有打开文件，则直接执行 `vi -O test_vi.txt test_vi2`.txt，此时两个文件左右排列，如果需要两个文件上下排列的话，执行 `vi -o test_vi.txt test_vi2.txt`。 vimdiff最多可以同时比较4个文件。
 
不退出vim，直接执行命令，例如在perl文件中，直接执行不退出，`:!perl %` 。 如果前面已经执行过了，则重复前面的命令时，只需要: `!!`

# 参考
1. [史上最全的Vim命令](http://www.178linux.com/88969) 
2. [vim的magic用法](https://www.cnblogs.com/penseur/archive/2011/02/25/1964522.html)
3. [VIM的高级使用](https://www.cnblogs.com/itech/archive/2012/02/22/2363111.html)
